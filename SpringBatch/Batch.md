## Batch
* Batch란 정해진 시간에 일괄적으로 작업을 처리한라는 뜻을 가지고 있다.(대체로 대용량 데이터)
* 즉, 데이터를 실시간으로 처리하지 않고 일괄적으로 모아서 한번에 처리하는 방식을 말한다.
* 그렇기 때문에 Running 중인 web기반으로 구현한다면 매우 비효율적이다.
* 일괄 처리를 작업하는 순간에만 Running되고 리소스를 사용해야 효율적인 프로그램이다.

## Spring Batch Architecture
* Spring Batch는 확성성 및 다양한 사용자의 유형을 고려하여 설계했다.
* 아래 그림은 Spring Barch의 계층 구조이다.

![image](https://user-images.githubusercontent.com/77063888/205103163-b6257b23-9d73-4d5e-85a1-d8f38789e2d1.png)

그림에서 보다시피 세 가지의 주요 컴포넌트가 있다.
* Application : Spring Batch를 사용하는 개발자가 만드는 모든 Batch Job과 Custom Code를 포함한다.
* Batch Core : Job을 실행하고 제어하는데 필요한 핵심 Runtime class를 포함한다. `JobLauncher`, `Job`, `Step` 구현체 또한 포함된다.
* Batch Infrastructure : 공통 reader와 writer, service(ex. `RetryTemplate`)를 포함하는데, application 개발자와 core framework 자체에서 활용하기도 한다.

## General Batch Principles and Guidelines
Batch solution은 아래 key principles, guidelines, 그리고 general considerations를 고려하여 개발해야 한다.

* 배치 아키텍쳐는 보통 온라인 아키텍쳐에 영향을 주고, 반대도 마찬가지임을 기억해야 한다. 가능하면 공통 구성 요소를 활용하고 아키텍처와 환경을 모두 고려해 설계해야 한다.
* 단일 배치 어플리케이션은 가능한 단순화하고, 복잡한 로직은 피해야 한다.
* 데이터의 처리와 저장을 물리적으로 가깝게 유지해야 한다. 즉, 데이터 처리가 발생하는 위치에 데이터를 유지(저장)해야 한다.
* 시스템 리소스 사용, 특히 I/O를 최소화해야 한다. 내장 메모리에서 가능한 한 많은 작업을 수행해야 한다.
* 애플리케이션 I/O를 검토(SQL문 분석)하여 불필요한 물리적 I/O를 방지해야 한다. 특히 아해 같은 4가지의 일반적인 결함을 주의해야 한다.
  * 한 번 읽고 캐시하거나 작업 스토리지에 저장해도 되는 데이터를 매 트랜잭션마다 읽는 경우
  * 동일한 트랜잭션 내에서 이전에 데이터를 읽은 트랜잭션의 데이터를 다시 읽는 경우
  * 불필요한 테이블 스캔이나 인덱스 스캔을 발생시키는 경우
  * SQL 구문에서 WHERE 적에 키를 지정하지 않는 경우.
*  배치 실행에 있어 같은 작업을 두 번 하지 않아야 한다. 예를 들어 보고 목적으로 데이터 요약이 필요한 경우 데이터를 처음 처리할 때 저장된 총계를(가능한 경우) 늘려야 하므로 보고 응용 프로그램에서 동일한 데이터를 재처리하지 않도록 해야 한다.
*  프로세스 중 재할당에 시간을 많이 소요하지 않게 배치 어플리케이션 시작 전 충분한 메모리를 할당해야 한다.
*  데이터 무결성은 최악의 상황도 고려해야 한다. 데이터 무결성을 유지하기 위해 적절한 검사와 유효성 검사 기록을 삽입해야 한다. 
*  가능한 경우 내부 검증을 위한 체크섬을 구현해야 한다. 예를 들어 플랫(flat) 파일은 파일의 총 레코드 수와 주요 필드의 집계 결과를 알 수 있는 트레일러 레코드가 필요하다.
*  실제 프로덕션 환경과 그에 맞는 데이터 볼륨을 가지고 가능한 조기에 부하 테스트를 계획하고 실행해야 한다.
*  대규모 배치 시스템이라면, 특히 그 시스템이 온라인과 동시에 무중단으로 실행되는 경우 백업이 매우 어려울 수 있다. 파일 백업도 데이터베이서 백업과 마찬가지로 중요하게 간주해야 한다. 시스템이 플랫 파일에 의존하는 경우, 파일 백업 절차를 수립하고 문서화할 뿐만 아니라 정기적으로 테스트해야 한다.


### Reference
* https://docs.spring.io/spring-batch/docs/4.2.x/reference/html/index-single.html#batchArchitectureConsiderations